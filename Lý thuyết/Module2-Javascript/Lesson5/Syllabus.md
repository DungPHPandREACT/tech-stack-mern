## Lesson 5: DOM v√† Event

>üí° T∆∞∆°ng t√°c gi·ªØa Javascript v√† HTML

# DOM l√† g√¨?

Document Object Model l√† c√°ch th·ªÉ hi·ªán c·ªßa to√†n b·ªô giao di·ªán c·ªßa ·ª©ng d·ª•ng web d∆∞·ªõi d·∫°ng c√°c object, thay v√¨ l√† c√°c th·∫ª HTML th√¥ng th∆∞·ªùng. N√≥ th·ªÉ hi·ªán l·∫°i to√†n b·ªô trang web ƒë·ªÉ ch∆∞∆°ng tr√¨nh c√≥ th·ªÉ thay ƒë·ªïi ƒë∆∞·ª£c c·∫•u tr√∫c, style ho·∫∑c n·ªôi dung. DOM th·ªÉ hi·ªán l·∫°i ·ª©ng d·ª•ng web d∆∞·ªõi d·∫°ng c√°c  ‚Äúnodes‚Äù v√† objects.

M·ªôt trang web l√† m·ªôt t√†i li·ªáu c√≥ th·ªÉ hi·ªÉn th·ªã tr√™n tr√¨nh duy·ªát ho·∫∑c m√£ ngu·ªìn HTML tr√™n c√°c text editor. V√† ƒë·ªëi v·ªõi c√°c ng√¥n ng·ªØ l·∫≠p tr√¨nh nh∆∞ Javascript, th·ªÉ hi·ªán c·ªßa trang web ƒë√≥ ch√≠nh l√† DOM.

![Untitled](./images-syllabus/tree-dom.png)

V·ªõi DOM, Javascript c√≥ th·ªÉ c√≥ kh·∫£ nƒÉng:

- Thay ƒë·ªïi to√†n b·ªô element HTML tr√™n trang web.
- Thay ƒë·ªïi thu·ªôc t√≠nh c·ªßa t·∫•t c·∫£ c√°c th·∫ª.
- Thay ƒë·ªïi style c·ªßa t·∫•t c·∫£ c√°c th·∫ª
- Xo√° c√°c HTML elements tr√™n trang web.
- Th√™m element v√†o b√™n trong trang web.
- X·ª≠ l√Ω c√°c events trong HTML

Trong h√¨nh tr√™n, ta th·∫•y c√°c DOM element ƒë∆∞·ª£c t·ªï ch·ª©c theo m√¥ h√¨nh d·∫°ng c√¢y (ph√¢n th·ª© b·∫≠c). Trong m√¥ h√¨nh c√¢y, ch√∫ng ta c∆° b·∫£n c√≥ c√°c kh√°i ni·ªám sau:

- Node: l√† m·ªôt ph·∫ßn t·ª≠ b·∫•t k·ª≥ trong c√¢y
- Node cha (parent node) l√† node n·∫±m ·ªü tr√™n v√† c√πng nh√°nh node hi·ªán t·∫°i. V√≠ d·ª•: `Form` l√† node cha c·ªßa `Button`, `Anchor` kh√¥ng ph·∫£i l√† cha c·ªßa `Radio`
- Node con (child node) l√† node n·∫±m b√™n d∆∞·ªõi thu·ªôc nh√°nh c·ªßa node hi·ªán t·∫°i. V√≠ d·ª•: `Radio` l√† con c·ªßa `Form` nh∆∞ng kh√¥ng ph·∫£i con c·ªßa `Anchor`
- Node anh em (sibling node) l√† c√°c node c√πng chung m·ªôt cha. Ngang h√†ng v·ªõi nhau. V√≠ d·ª•: `Button` v√† `Reset` l√† 2 node anh em

## C√°c thao t√°c v·ªõi DOM document

Trong DOM, `document` ch√≠nh l√† object ƒë·∫°i di·ªán cho trang web c·ªßa ch√∫ng ta. V·ªõi document, ch√∫ng ta c√≥ th·ªÉ th·ª±c hi·ªán c√°c vi·ªác sau:

### T√¨m ki·∫øm elements trong document:

- `document.getElementById()`: t√¨m element ƒë·∫ßu ti√™n trong trang web v·ªõi ID t∆∞∆°ng ·ª©ng
- `document.getElementsByTagName()`: t√¨m t·∫•t c·∫£ c√°c elements trong trang web theo t√™n th·∫ª
- `document.getElementsByClassName()`: t√¨m t·∫•t c·∫£ c√°c elements trong trang web c√≥ ch·ª©a class t∆∞∆°ng ·ª©ng.
- `document.querySelectorAll(selector)`: t√¨m t·∫•t c·∫£ c√°c elements trong trang web d·ª±a theo CSS Selector.

VD:

```jsx
// find element that have id is myElm
const myElm = document.getElementById("myElm")

// get all img element inside the page
const allImages = document.getElementsByTagNames('img')
```

### Thay ƒë·ªìi gi√° tr·ªã c·ªßa m·ªôt element:

- `element.innerHTML = new_html_content`: thay ƒë·ªïi n·ªôi dung b√™n trong m·ªôt element
- `element.attribute = new_value`: thay ƒë·ªïi gi√° tr·ªã c·ªßa m·ªôt thu·ªôc t√≠nh c·ªßa element
- `element.style.attribute = new_value`: thay ƒë·ªïi style c·ªßa m·ªôt element

VD:

```jsx
const myElm = document.getElementById("myElm")
myElm.innerHTML = "Hello, World!"
myElm.style.backgroundColor = "green"

const input = document.getElementById("myInput")
input.type = 'password'
```

### Th√™m m·ªõi ho·∫∑c xo√° elements:

- `document.createElement()`: T·∫°o m·ªõi m·ªôt element
- `document.removeChild()`: Xo√° m·ªôt element l√† node con c·ªßa m·ªôt element kh√°c.
- `document.appendChild()`: Th√™m m·ªôt element con v√†o sau c√πng c·ªßa m·ªôt element kh√°c.
- `document.replaceChild()`: Thay th·∫ø node con b·∫±ng m·ªôt node con kh√°c

C√°c ph∆∞∆°ng th·ª©c tr√™n ƒë·ªÅu c√≥ th·ªÉ s·ª≠ d·ª•ng v·ªõi t·∫•t c√°c c√°c Node trong DOM tree, kh√¥ng nh·∫•t thi·∫øt ph·∫£i l√† document.

V√≠ d·ª•:

```jsx
const todoList = ["Homework", "Jogging", "Shopping"]

const ul = document.createElement("ul")

for (let i = 0; i < todoList.length; i++) {
	const li = document.createElement("li")
	li.innerHTML = todoList[i]
	ul.appendChild(li)
}

document.appendChild(ul)
```

---

# Events v√† t∆∞∆°ng t√°c v·ªõi Events

Event ƒë∆∞·ª£c hi·ªÉu l√† c√°c s·ª± ki·ªán x·∫£y ra tr√™n ·ª©ng d·ª•ng web. V√≠ d·ª•: khi ng∆∞·ªùi d√πng click chu·ªôt v√†o m·ªôt button, ng∆∞·ªùi d√πng ƒë√≥ ƒë√£ t·∫°o ra m·ªôt event l√† `click`; khi ng∆∞·ªùi d√πng di chuy·ªÉn con chu·ªôt qua m·ªôt b·ª©c ·∫£nh, ng∆∞·ªùi ƒë√≥ ƒë√£ t·∫°o ra m·ªôt event l√† `mouseover`, ‚Ä¶ T·∫•t c·∫£ c√°c thao t√°c c·ªßa ng∆∞·ªùi d√πng t√°c ƒë·ªông v√†o ·ª©ng d·ª•ng web c·ªßa ch√∫ng ta ƒë·ªÅu ƒë∆∞·ª£c g·ªçi l√† c√°c s·ª± ki·ªán. V·ªõi DOM v√† Javascript, ch√∫ng ta c√≥ th·ªÉ ch·∫°y m·ªôt ƒëo·∫°n code b·∫•t k√¨ khi s·ª± ki·ªán ƒë∆∞·ª£c t·∫°o ra, t·ª´ ƒë√≥ n√¢ng cao tr·∫£i nghi·ªám ng∆∞·ªùi d√πng v·ªõi trang web. V√≠ d·ª• nh∆∞ ƒë·ªïi m√†u n·ªÅn c·ªßa `button` khi ng∆∞·ªùi d√πng click v√†o n√≥.

M·ªôt s·ªë v√≠ d·ª• v·ªÅ events trong HTML:

- Khi ng∆∞·ªùi d√πng click chu·ªôt
- Khi trang web ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng
- Khi m·ªôt b·ª©c ·∫£nh ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng
- Khi di chu·ªôt qua m·ªôt HTML element
- Khi gi√° tr·ªã `input` b·ªã thay ƒë·ªïi
- Khi m·ªôt `form` ƒë∆∞·ª£c submit
- Khi ng∆∞·ªùi d√πng g√µ m·ªôt ph√≠m tr√™n b√†n ph√≠m

Trong t·∫•t c·∫£ c√°c s·ª± ki·ªán HTML, ch√∫ng ta ƒë·ªÅu c√≥ th·ªÉ s·ª≠ d·ª•ng Javascript ƒë·ªÉ can thi·ªáp v√† th·ª±c hi·ªán m·ªôt logic b·∫•t k·ª≥

## `onClick`

M·ªôt trong nh·ªØng c√°ch ƒë∆°n gi·∫£n nh·∫•t ƒë·ªÉ x·ª≠ l√Ω m·ªôt s·ª± ki·ªán v·ªõi Javascript l√† s·ª≠ d·ª•ng thu·ªôc t√≠nh c·ªßa c√°c th·∫ª HTML. C√°c th·∫ª HTML ƒë·ªÅu c√≥ c√°c thu·ªôc t√≠nh l√† `onclick`,  `onchange`, ‚Ä¶ Ch√∫ng ta c√≥ th·ªÉ truy·ªÉn tr·ª±c ti·∫øp m·ªôt function v√†o b√™n trong c√°c thu·ªôc t√≠nh ƒë√≥ ƒë·ªÉ ch·∫°y m·ªôt ƒëo·∫°n logic t∆∞∆°ng ·ª©ng khi event x·∫£y ra.

```jsx
<button onclick="sayHello()">Click me</button>

...

<script>
	function sayHello() {
		alert("hello, world!")
	}
</script>
```

Ch√∫ng ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng Javascript ƒë·ªÉ thay ƒë·ªïi gi√° tr·ªã `onclick` c·ªßa c√°c th·∫ª HTML th√¥ng qua DOM:

```jsx
<button id="clickMe">Click me</button>

...

<script>
	function sayHello() {
		alert("hello, world!")
	}
	const btn = document.getElementById("clickMe")
	btn.onclick = sayHello;
</script>
```

## `.addEventListener`

Ngo√†i s·ª≠ d·ª•ng c√°c thu·ªôc t√≠nh HTML nh∆∞ `onclick` ·ªü tr√™n, ch√∫ng ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt function ƒë·∫∑c bi·ªát l√† `addEventListener`.

Gi·ªëng nh∆∞ t√™n g·ªçi c·ªßa n√≥, `addEventListener` l√†m m·ªôt nhi·ªám v·ª• l√† ‚Äúth√™m‚Äù m·ªôt ‚Äúevent listener‚Äù v√†o cho m·ªôt element. ‚ÄúEvent listener‚Äù c√≥ th·ªÉ ƒë∆∞·ª£c hi·ªÉu ƒë∆°n gi·∫£n l√† m·ªôt function s·∫Ω ƒë∆∞·ª£c ch·∫°y khi m·ªôt event ƒë∆∞·ª£c t·∫°o ra. N√≥ c√≥ √Ω nghƒ©a kh√° t∆∞∆°ng t·ª± so v·ªõi `onclick` ·ªü tr√™n. C√∫ ph√°p c·ªßa `addEventListener` l√†:

```jsx
element.addEventListener('<event>', function () {})
```

Trong ƒë√≥, `<event>` ·ªü ƒë√¢y l√† c√°c s·ª± ki·ªán nh∆∞ `click`, `mousemove`, ‚Ä¶

M·ªôt v√†i v√≠ d·ª• nh∆∞ sau:

```jsx
const myBtn = document.getElementById("myBtn")
function sayHello() {
	console.log("hello")
}
myBtn.addEventListener("click", sayHello)

const myInput = document.getElementById("myInput")
myInput.addEventListener("change", function() {
	console.log("input changed")
})
```

ƒêi·ªÉm kh√°c bi·ªát ·ªü ƒë√¢y l√† v·ªõi `addEventListener`, ch√∫ng ta c√≥ th·ªÉ c√≥ nhi·ªÅu listener c√πng ƒë∆∞·ª£c ch·∫°y khi m·ªôt event x·∫£y ra.

```jsx
const myBtn = document.getElementById("myBtn")
function sayHello() {
	console.log("hello")
}
myBtn.addEventListener("click", sayHello)
myBtn.addEventListener("click", function() {
	console.log("another event listener");
})
```

V·ªõi c√°ch n√†y, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt function l√† `removeEventListener` ƒë·ªÉ c√≥ th·ªÉ remove c√°c listener kh·ªèi element ƒë√≥

```jsx
const myBtn = document.getElementById("myBtn")
function sayHello() {
	console.log("hello")
}
myBtn.addEventListener("click", sayHello)
myBtn.addEventListener("click", function() {
	console.log("another event listener");
})

// later
myBtn.removeEventListener("click", sayHello)
```

## Tham s·ªë `event` b√™n trong listener

C√°c h√†m event listener ƒë·ªÅu nh·∫≠n ƒë∆∞·ª£c tham s·ªë ƒë·∫ßu v√†o l√† m·ªôt object `event`. Tham s·ªë ƒë·∫ßu v√†o n√†y cho ph√©p ch√∫ng ta t∆∞∆°ng t√°c ƒë∆∞·ª£c v·ªõi `event` ƒë√≥. M·ªôt trong nh·ªØng tr∆∞·ªùng h·ª£p th∆∞·ªùng g·∫∑p l√† khi ch√∫ng ta x·ª≠ l√Ω s·ª± ki·ªán submit c·ªßa form.

```html
<form id="myForm">
...
</form>

...

<script>
	const form = document.getElementById("myForm")
	form.addEventListener("submit", function(event) {
		event.preventDefault();
		// logic here
	})
</script>
```

Ngo√†i ra, trong object event, ch√∫ng ta c√≤n c√≥ th·ªÉ truy c·∫≠p t·ªõi nhi·ªÅu thu·ªôc t√≠nh ho·∫∑c ph∆∞∆°ng th·ª©c c·ªßa ch√∫ng nh∆∞ `shiftKey`, `metaKey`, `target` ho·∫∑c `stopPropagation()`, ‚Ä¶

## **Event Bubbling hay Event Capturing?**

Gi·∫£ s·ª≠ ch√∫ng ta c√≥ tr∆∞·ªùng h·ª£p sau:

```html
<div id="myDiv">
	<p id="myP">This is a paragraph</p>
</div>

...

<script>
	const p = document.getElementById('myP')
	const div = document.getElementById('myDiv')

	div.addEventListener('click', function() {
		console.log('div clicked')
	})

	p.addEventListener('click', function() {
		console.log('p clicked')
	})
</script>
```

Khi n√†y, n·∫øu ta click v√†o th·∫ª `p`, li·ªáu r·∫±ng d√≤ng log n√†o s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ra tr∆∞·ªõc?

Javascript c√≥ 2 c√°ch ƒë·ªÉ x·ª≠ l√Ω vi·ªác n√†y: ƒêi t·ª´ trong ra ngo√†i ho·∫∑c ƒëi t·ª´ ngo√†i v√†o trong

- V·ªõi event bubbling trong v√≠ d·ª• tr√™n, s·ª± ki·ªán click s·∫Ω x·∫£y ra v·ªõi th·∫ª `p` tr∆∞·ªõc v√† sau ƒë√≥ l√† th·∫ª `div`. Hay n√≥i c√°ch kh√°c, event ƒë∆∞·ª£c n·ªïi t·ª´ b√™n trong ra b√™n ngo√†i.
- V·ªõi event capturing trong v√≠ d·ª• tr√™n, s·ª± ki·ªán click s·∫Ω x·∫£y ra v·ªõi th·∫ª `div` tr∆∞·ªõc v√† sau ƒë√≥ l√† th·∫ª `p` b√™n trong. Hay n√≥i c√°ch kh√°c, event ƒë∆∞·ª£c b·∫Øt t·ª´ ngo√†i v√†o trong.

ƒê·ªÉ thay ƒë·ªïi ƒë∆∞·ª£c h√†nh vi n√†y, ch√∫ng ta c√≥ th·ªÉ truy·ªÉn th√™m tham s·ªë th·ª© 3 cho function `addEventListener`. Tham s·ªë n√†y nh·∫≠n v√†o gi√° tr·ªã l√† boolean (`true` ho·∫∑c `false`). M·∫∑c ƒë·ªãnh, gi√° tr·ªã n√†y ƒë∆∞·ª£c x√°c ƒë·ªãnh l√† `false`, ƒë·ªìng nghƒ©a v·ªõi vi·ªác event s·∫Ω ƒë∆∞·ª£c bubbling: ƒëi t·ª´ trong ra ngo√†i. Ta c√≥ th·ªÉ thay ƒë·ªïi gi√° tr·ªã c·ªßa tham s·ªë n√†y ƒë·ªÉ thay ƒë·ªïi h√†nh vi c·ªßa event

```html
<div id="myDiv">
	<p id="myP">This is a paragraph</p>
</div>

...

<script>
	const p = document.getElementById('myP')
	const div = document.getElementById('myDiv')

	div.addEventListener('click', function() {
		console.log('div clicked')
	}, true)

	p.addEventListener('click', function() {
		console.log('p clicked')
	}, true)
</script>
```
